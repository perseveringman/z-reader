# Z-Reader é”®ç›˜å¿«æ·é”®å®¡è®¡ â€” Readwise Reader å¯¹é½åˆ†æ

> **Date:** 2026-02-09
> **Scope:** å…¨éƒ¨é”®ç›˜äº‹ä»¶å¤„ç†é€»è¾‘ + Readwise Reader å¿«æ·é”®å¯¹æ¯”

---

## 1. ç°æœ‰å¿«æ·é”®æ¸…å•

### 1.1 å…¨å±€å¿«æ·é”® (App.tsx)

| å¿«æ·é”® | åŠ¨ä½œ | `preventDefault` | `stopPropagation` |
|--------|------|:-:|:-:|
| `Cmd/Ctrl + K` | åˆ‡æ¢å‘½ä»¤é¢æ¿ | âœ… | âŒ |
| `/` | æ‰“å¼€æœç´¢ | âœ… | âŒ |
| `?` | åˆ‡æ¢å¿«æ·é”®å¸®åŠ© | âœ… | âŒ |

**Guard:** æ£€æŸ¥ `INPUT/TEXTAREA` æ ‡ç­¾, è·³è¿‡ã€‚

### 1.2 æ–‡ç« åˆ—è¡¨å¿«æ·é”® (ContentList.tsx)

| å¿«æ·é”® | åŠ¨ä½œ | `preventDefault` | `stopPropagation` |
|--------|------|:-:|:-:|
| `j` / `â†“` | ä¸‹ä¸€ç¯‡æ–‡ç«  | âœ… | âŒ |
| `k` / `â†‘` | ä¸Šä¸€ç¯‡æ–‡ç«  | âœ… | âŒ |
| `Enter` | æ‰“å¼€é˜…è¯»è§†å›¾ | âŒ | âŒ |
| `1` | åˆ‡æ¢åˆ° Inbox | âŒ | âŒ |
| `2` | åˆ‡æ¢åˆ° Later | âŒ | âŒ |
| `3` | åˆ‡æ¢åˆ° Archive | âŒ | âŒ |
| `E` / `e` | å½’æ¡£ | âŒ | âŒ |
| `L` / `l` | ç¨åé˜…è¯» | âŒ | âŒ |
| `D` / `d` | åˆ é™¤ | âŒ | âŒ |
| `Z` / `z` | æ’¤é”€ | âŒ âš ï¸ | âŒ |
| `S` / `s` | æ”¶è—/å–æ¶ˆæ”¶è— | âŒ | âŒ |
| `Escape` | æ¸…é™¤å¤šé€‰ | âœ… | âŒ |

**Guard:** æ£€æŸ¥ `INPUT/TEXTAREA` æ ‡ç­¾, è·³è¿‡ã€‚

### 1.3 é˜…è¯»è§†å›¾å¿«æ·é”® (ReaderView.tsx)

| å¿«æ·é”® | åŠ¨ä½œ | `preventDefault` | `stopPropagation` |
|--------|------|:-:|:-:|
| `j` / `â†“` | ä¸‹ä¸€æ®µè½ | âœ… | âŒ |
| `k` / `â†‘` | ä¸Šä¸€æ®µè½ | âœ… | âŒ |
| `H` / `h` | é«˜äº®å½“å‰æ®µè½ | âœ… | âŒ |
| `Escape` | å…³é—­å·¥å…·æ /é€€å‡ºé˜…è¯» | âŒ | âŒ |

**Guard:** Escape æ—  INPUT/TEXTAREA æ£€æŸ¥ï¼ˆå…ˆå¤„ç†ï¼‰, å…¶ä½™æ£€æŸ¥ã€‚

### 1.4 å¼¹çª—/å¯¹è¯æ¡† Escape å¤„ç†

ä»¥ä¸‹ç»„ä»¶å‡åœ¨ `document` ä¸Šç›‘å¬ `keydown`, å¤„ç† Escape å…³é—­:

| ç»„ä»¶ | `preventDefault` | `stopPropagation` |
|------|:-:|:-:|
| KeyboardShortcutsHelp.tsx | âŒ | âŒ |
| ContextMenu.tsx | âŒ | âŒ |
| AddFeedDialog.tsx | âŒ | âŒ |
| FeedManageDialog.tsx | âŒ | âŒ |

### 1.5 SearchPanel / CommandPalette

è¿™ä¸¤ä¸ªç»„ä»¶ä½¿ç”¨ **React `onKeyDown` å±æ€§**ï¼ˆä¸æ˜¯ document listenerï¼‰ï¼Œå¤„ç† `â†‘/â†“/Enter/Escape`ã€‚å› ä¸ºå®ƒä»¬ç»‘å®šåœ¨ React å…ƒç´ ä¸Šè€Œé document, ä¸ä¼šä¸ä¸Šè¿° handler ç›´æ¥å†²çªã€‚

---

## 2. å·²å‘ç°çš„ Bug

### ğŸ”´ BUG-1: Z (Undo) ç¼ºå°‘ preventDefault â€” ä¸¥é‡

**ä½ç½®:** `ContentList.tsx:378-381`

```typescript
case 'z':
case 'Z': {
  if (undoStack.canUndo) undoStack.undo();
  break;  // â† ç¼ºå°‘ e.preventDefault()
}
```

**é—®é¢˜:** å½“ç”¨æˆ·æŒ‰ `Z` é”®, æµè§ˆå™¨/Electron ä¸ä¼šæœ‰é»˜è®¤è¡Œä¸ºé—®é¢˜ã€‚ä½†å½“ç”¨æˆ·æŒ‰ `Cmd+Z`ï¼ˆmacOS æ ‡å‡†æ’¤é”€ï¼‰, è¿™ä¸ª handler ä¼šæ•è· `e.key === 'z'` (lowercase), åŒæ—¶:
1. App çš„æ’¤é”€æ ˆæ‰§è¡Œäº† `undo()`
2. Electron webContents çš„åŸç”Ÿ undo ä¹Ÿå¯èƒ½è§¦å‘

æ›´ä¸¥é‡çš„æ˜¯, è¿™ä¸ª handler æ²¡æœ‰æ£€æŸ¥ `e.metaKey`, æ‰€ä»¥ `Cmd+Z` å’Œå•ç‹¬çš„ `Z` éƒ½ä¼šè§¦å‘åº”ç”¨æ’¤é”€ â€” è¿™ä¸ Readwise Reader çš„è¡Œä¸ºä¸€è‡´(å•é”® `z` æ’¤é”€), ä½†åº”è¯¥åŠ  `preventDefault()` é˜»æ­¢åŸç”Ÿè¡Œä¸ºã€‚

**ä¿®å¤:**
```typescript
case 'z':
case 'Z': {
  if (undoStack.canUndo) {
    e.preventDefault();
    undoStack.undo();
  }
  break;
}
```

### ğŸŸ¡ BUG-2: æ–‡ç« æ“ä½œé”®ç¼ºå°‘ preventDefault

**ä½ç½®:** `ContentList.tsx:360-386`

`1/2/3/E/L/D/S` å‡ç¼ºå°‘ `e.preventDefault()`ã€‚åœ¨ Electron ä¸­é€šå¸¸ä¸ä¼šé€ æˆå¯è§é—®é¢˜, å› ä¸ºè¿™äº›é”®æ²¡æœ‰æµè§ˆå™¨é»˜è®¤è¡Œä¸ºã€‚ä½†è¿™æ˜¯ä¸è§„èŒƒçš„åšæ³•, å¦‚æœæœªæ¥è¿ç§»ä¸º web ç‰ˆæœ¬ä¼šæš´éœ²é—®é¢˜ã€‚

**å»ºè®®:** ç»Ÿä¸€ä¸ºæ‰€æœ‰å¤„ç†çš„ case æ·»åŠ  `e.preventDefault()`ã€‚

### ğŸŸ¡ BUG-3: å¤šä¸ª Escape listener æ— åè°ƒæœºåˆ¶

**é—®é¢˜:** 7+ ä¸ªç»„ä»¶å„è‡ªåœ¨ `document` ä¸Šç›‘å¬ `keydown`, éƒ½å¤„ç† Escape:

```
App.tsx (æ—  Escape handler)
ContentList.tsx â†’ æ¸…é™¤å¤šé€‰
ReaderView.tsx â†’ å…³é—­å·¥å…·æ æˆ–é€€å‡ºé˜…è¯»
KeyboardShortcutsHelp.tsx â†’ å…³é—­å¸®åŠ©
ContextMenu.tsx â†’ å…³é—­èœå•
AddFeedDialog.tsx â†’ å…³é—­å¯¹è¯æ¡†
FeedManageDialog.tsx â†’ å…³é—­å¯¹è¯æ¡†
```

ç”±äºæ‰€æœ‰ listener å‡æŒ‚è½½åœ¨ `document` ä¸Š, ä¸”æ²¡æœ‰ä»»ä½•ä¸€ä¸ªè°ƒç”¨ `e.stopPropagation()` æˆ– `e.stopImmediatePropagation()`, **ä¸€æ¬¡ Escape æŒ‰é”®ä¼šè§¦å‘æ‰€æœ‰å·²æŒ‚è½½çš„ handler**ã€‚

**å½“å‰ä¸ºä½•æ²¡æœ‰å‡ºå¤§é—®é¢˜:** æ¯ä¸ª handler å†…éƒ¨æœ‰çŠ¶æ€ guard (å¦‚ `if (!open) return`), æ‰€ä»¥é€šå¸¸åªæœ‰"æœ€é¡¶å±‚"çš„å¼¹çª—ä¼šå“åº”ã€‚ä½†å­˜åœ¨è¾¹ç¼˜æƒ…å†µ:
- å¦‚æœåŒæ—¶æ‰“å¼€ ContextMenu å’Œ Shortcuts Help, Escape ä¼šåŒæ—¶å…³é—­ä¸¤è€…
- ContentList çš„ Escape (æ¸…é™¤å¤šé€‰) ä¼šåœ¨ä»»ä½•å¼¹çª—å…³é—­æ—¶ä¹Ÿæ‰§è¡Œ

**å»ºè®®:** åœ¨å¼¹çª—/å¯¹è¯æ¡†çš„ Escape handler ä¸­åŠ  `e.stopImmediatePropagation()`, å»ºç«‹"æœ€é¡¶å±‚ä¼˜å…ˆ"çš„å…³é—­ç­–ç•¥ã€‚

### ğŸŸ¢ BUG-4: ReaderView Escape æ—  INPUT/TEXTAREA guard

**ä½ç½®:** `ReaderView.tsx:235-241`

```typescript
if (e.key === 'Escape') {
  if (toolbarPos) {
    setToolbarPos(null);
    return;
  }
  onClose();  // â† ç›´æ¥å…³é—­é˜…è¯»è§†å›¾
  return;
}
// INPUT/TEXTAREA guard åœ¨ä¸‹æ–¹, Escape ä¸å—ä¿æŠ¤
```

**é—®é¢˜:** å¦‚æœç”¨æˆ·åœ¨é«˜äº®ç¬”è®°çš„ textarea ä¸­æŒ‰ Escape, é¢„æœŸè¡Œä¸ºæ˜¯"å–æ¶ˆç¼–è¾‘", ä½†å®é™…ä¼šç›´æ¥å…³é—­æ•´ä¸ªé˜…è¯»è§†å›¾ã€‚

**ä¿®å¤:** å°† INPUT/TEXTAREA guard ç§»åˆ° Escape å¤„ç†ä¹‹å‰, æˆ–è®© Escape åœ¨ textarea ä¸­åªå–æ¶ˆç¼–è¾‘ã€‚

---

## 3. Readwise Reader å¯¹é½åˆ†æ

### 3.1 Z-Reader å·²æœ‰ä½†ä¸ Readwise ä¸€è‡´çš„å¿«æ·é”®

| å¿«æ·é”® | åŠ¨ä½œ | çŠ¶æ€ |
|--------|------|------|
| `j/k/â†‘/â†“` | åˆ—è¡¨/æ®µè½å¯¼èˆª | âœ… ä¸€è‡´ |
| `Enter` | æ‰“å¼€é˜…è¯»è§†å›¾ | âœ… ä¸€è‡´ (Readwise ä¹Ÿæœ‰ `o`) |
| `e` | å½’æ¡£ | âœ… ä¸€è‡´ |
| `d` | åˆ é™¤ | âœ… ä¸€è‡´ |
| `z` | æ’¤é”€ | âœ… ä¸€è‡´ |
| `s` | æ”¶è—/Shortlist | âœ… ä¸€è‡´ |
| `h` | é«˜äº®æ®µè½ | âœ… ä¸€è‡´ |
| `/` | æœç´¢ | âœ… ä¸€è‡´ |
| `Cmd+K` | å‘½ä»¤é¢æ¿ | âœ… ä¸€è‡´ |
| `?` | å¿«æ·é”®å¸®åŠ© | âœ… ä¸€è‡´ |
| `Escape` | è¿”å›/å…³é—­ | âœ… ä¸€è‡´ |

### 3.2 Z-Reader æœ‰ä½†æ˜ å°„ä¸åŒ

| Z-Reader | Readwise | åŠ¨ä½œ | è¯´æ˜ |
|----------|----------|------|------|
| `L` | `l` | ç¨åé˜…è¯» | âœ… å®é™…ä¸€è‡´, Z-Reader åŒæ—¶æ¥å—å¤§å°å†™ |
| `1/2/3` | `gâ†’i / gâ†’l / gâ†’a` | åˆ‡æ¢ Inbox/Later/Archive | Readwise ä½¿ç”¨ vim é£æ ¼ä¸¤é”®åºåˆ—; Z-Reader ä½¿ç”¨æ•°å­—é”®ç›´æ¥åˆ‡æ¢ |

**å»ºè®®:** `1/2/3` çš„æ˜ å°„æ›´ç›´è§‰, å¯ä»¥ä¿ç•™ã€‚ä½†æ³¨æ„: Readwise åœ¨é˜…è¯»è§†å›¾ä¸­ `1/2/3/4` ç”¨äºåˆ‡æ¢é«˜äº®é¢œè‰², è¿™ä¸ Z-Reader çš„ tab åˆ‡æ¢ä¼šå†²çªã€‚

### 3.3 Readwise æœ‰ä½† Z-Reader ç¼ºå¤±çš„å¿«æ·é”®

| å¿«æ·é”® | åŠ¨ä½œ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|--------|------|--------|------|
| `o` | æ‰“å¼€é˜…è¯»è§†å›¾ (åŒ Enter) | LOW | Enter å·²è¶³å¤Ÿ |
| `n` | æ·»åŠ ç¬”è®° | **HIGH** | é˜…è¯»è§†å›¾ä¸­å¯¹å½“å‰é«˜äº®æ·»åŠ ç¬”è®° |
| `t` | æ·»åŠ æ ‡ç­¾ | **MEDIUM** | åœ¨åˆ—è¡¨è§†å›¾ä¸­å¿«é€Ÿæ‰“æ ‡ç­¾ |
| `w` | åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åŸå§‹é“¾æ¥ | **MEDIUM** | æ–¹ä¾¿å¿«é€Ÿè·³è½¬åŸæ–‡ |
| `i` | åˆ‡æ¢ä¿¡æ¯é¢æ¿ | LOW | å³ä¾§ DetailPanel çš„æ˜¾ç¤º/éšè— |
| `Space` | å‘ä¸‹ç¿»é¡µ | **HIGH** | é˜…è¯»è§†å›¾ä¸­æ•´é¡µæ»šåŠ¨ |
| `Shift+Space` | å‘ä¸Šç¿»é¡µ | **HIGH** | é˜…è¯»è§†å›¾ä¸­æ•´é¡µæ»šåŠ¨ |
| `[` / `]` | ä¸Šä¸€ç¯‡/ä¸‹ä¸€ç¯‡æ–‡ç«  | MEDIUM | åœ¨é˜…è¯»è§†å›¾ä¸­åˆ‡æ¢æ–‡ç«  |
| `1/2/3/4` (é˜…è¯»è§†å›¾) | åˆ‡æ¢é«˜äº®é¢œè‰² | LOW | é»„/çº¢/ç»¿/è“ |

---

## 4. å»ºè®®ä¿®å¤æ–¹æ¡ˆ

### Phase 1: ä¿® Bugï¼ˆç«‹å³æ‰§è¡Œï¼‰

1. **BUG-1:** ContentList `Z` æ·»åŠ  `e.preventDefault()`
2. **BUG-2:** ContentList æ‰€æœ‰ action key ç»Ÿä¸€æ·»åŠ  `e.preventDefault()`
3. **BUG-3:** æ‰€æœ‰å¼¹çª— Escape handler æ·»åŠ  `e.stopImmediatePropagation()`
4. **BUG-4:** ReaderView Escape å¢åŠ  INPUT/TEXTAREA guard

### Phase 2: è¡¥é½ Readwise å¿«æ·é”®ï¼ˆå¯é€‰ï¼‰

ä¼˜å…ˆçº§ HIGH:
- `Space` / `Shift+Space` â€” é˜…è¯»è§†å›¾ç¿»é¡µ
- `n` â€” é˜…è¯»è§†å›¾æ·»åŠ ç¬”è®°

ä¼˜å…ˆçº§ MEDIUM:
- `t` â€” åˆ—è¡¨è§†å›¾å¿«é€Ÿæ‰“æ ‡ç­¾
- `w` â€” åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åŸå§‹é“¾æ¥
- `[` / `]` â€” é˜…è¯»è§†å›¾ä¸­å‰åæ–‡ç« åˆ‡æ¢

### Phase 3: æ¶æ„æ”¹è¿›ï¼ˆå¯é€‰ï¼‰

- è€ƒè™‘ç»Ÿä¸€çš„å¿«æ·é”®ç®¡ç† hook (`useKeyboardShortcut`), æ›¿ä»£å„ç»„ä»¶åˆ†æ•£çš„ `document.addEventListener`
- å®ç°å±‚çº§ Escape ç­–ç•¥: æœ€é¡¶å±‚å¼¹çª—ä¼˜å…ˆå“åº”, é˜»æ­¢ä¸‹å±‚ handler

---

## 5. é˜…è¯»è§†å›¾ 1/2/3 å†²çªè¯´æ˜

å½“å‰ `1/2/3` åœ¨ ContentList ä¸­åˆ‡æ¢ Inbox/Later/Archive tabã€‚å¦‚æœæœªæ¥è¦åœ¨é˜…è¯»è§†å›¾ä¸­ç”¨ `1/2/3/4` åˆ‡æ¢é«˜äº®é¢œè‰² (Readwise çš„åšæ³•), éœ€è¦ç¡®ä¿:
- ReaderView æŒ‚è½½æ—¶ ContentList å·²å¸è½½ (å½“å‰æ¶æ„: âœ… `readerMode === true` æ—¶ ContentList ä¸æ¸²æŸ“)
- æ‰€ä»¥ **ä¸ä¼šå†²çª**, å¯ä»¥æ”¾å¿ƒåœ¨ä¸¤ä¸ªä¸Šä¸‹æ–‡ä¸­å¤ç”¨æ•°å­—é”®

---

## 6. KeyboardShortcutsHelp é¢æ¿åŒæ­¥

ä¿®å¤å®Œæˆå, éœ€è¦åŒæ­¥æ›´æ–° `KeyboardShortcutsHelp.tsx` ä¸­çš„å¿«æ·é”®åˆ—è¡¨, ç¡®ä¿æ–‡æ¡£ä¸å®é™…è¡Œä¸ºä¸€è‡´ã€‚
