"use strict";(()=>{var a="http://127.0.0.1:21897/api";async function s(t,e){let i=`${a}${t}`,r=await fetch(i,{headers:{"Content-Type":"application/json"},...e});if(!r.ok){let m=await r.text().catch(()=>"\u672A\u77E5\u9519\u8BEF");throw new Error(`API \u8BF7\u6C42\u5931\u8D25 [${r.status}]: ${m}`)}return r.json()}async function c(){await s("/open")}async function l(){try{return(await fetch(`${a}/status`,{method:"GET"})).ok}catch{return!1}}async function g(t){return s("/articles",{method:"POST",body:JSON.stringify(t)})}async function h(t){return s(`/highlights?url=${encodeURIComponent(t)}`)}var o=document.getElementById("status"),n=document.getElementById("save-btn"),u=document.getElementById("article-info"),d=document.getElementById("article-title"),y=document.getElementById("article-meta"),p=document.getElementById("open-app");async function f(){if(await l())o.textContent="\u5DF2\u8FDE\u63A5",o.className="status status--online";else{o.textContent="\u672A\u8FDE\u63A5 \u2014 \u8BF7\u542F\u52A8 Z-Reader",o.className="status status--offline",n.setAttribute("disabled","true");return}let[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(e?.url)try{let i=await h(e.url);i.articleId&&(d.textContent=e.title??"\u65E0\u6807\u9898",y.textContent=`\u5DF2\u6709 ${i.highlights.length} \u6761\u9AD8\u4EAE`,u.style.display="block",n.textContent="\u2705 \u5DF2\u4FDD\u5B58",n.setAttribute("disabled","true"))}catch{}}n.addEventListener("click",async()=>{let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(t?.url){n.textContent="\u4FDD\u5B58\u4E2D...",n.setAttribute("disabled","true");try{let e=await g({url:t.url,title:t.title});d.textContent=e.title??"\u65E0\u6807\u9898",y.textContent=`\u4FDD\u5B58\u4E8E ${new Date(e.createdAt).toLocaleString("zh-CN")}`,u.style.display="block",n.textContent="\u2705 \u5DF2\u4FDD\u5B58",t.id&&chrome.tabs.sendMessage(t.id,{type:"ARTICLE_SAVED",payload:e})}catch(e){n.textContent="\u274C \u4FDD\u5B58\u5931\u8D25",n.removeAttribute("disabled"),console.error("\u4FDD\u5B58\u5931\u8D25:",e)}}});p.addEventListener("click",async()=>{try{await c()}catch{}});f();})();
