"use strict";(()=>{var o="http://127.0.0.1:21897/api";async function c(t,e){let n=`${o}${t}`,r=await fetch(n,{headers:{"Content-Type":"application/json"},...e});if(!r.ok){let y=await r.text().catch(()=>"\u672A\u77E5\u9519\u8BEF");throw new Error(`API \u8BF7\u6C42\u5931\u8D25 [${r.status}]: ${y}`)}return r.json()}async function a(){try{return(await fetch(`${o}/status`,{method:"GET"})).ok}catch{return!1}}async function l(t){return c("/articles",{method:"POST",body:JSON.stringify(t)})}async function h(t){return c(`/highlights?url=${encodeURIComponent(t)}`)}var s=document.getElementById("status"),i=document.getElementById("save-btn"),g=document.getElementById("article-info"),u=document.getElementById("article-title"),d=document.getElementById("article-meta");async function m(){if(await a())s.textContent="\u5DF2\u8FDE\u63A5",s.className="status status--online";else{s.textContent="\u672A\u8FDE\u63A5 \u2014 \u8BF7\u542F\u52A8 Z-Reader",s.className="status status--offline",i.setAttribute("disabled","true");return}let[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(e?.url)try{let n=await h(e.url);n.articleId&&(u.textContent=e.title??"\u65E0\u6807\u9898",d.textContent=`\u5DF2\u6709 ${n.highlights.length} \u6761\u9AD8\u4EAE`,g.style.display="block",i.textContent="\u2705 \u5DF2\u4FDD\u5B58",i.setAttribute("disabled","true"))}catch{}}i.addEventListener("click",async()=>{let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(t?.url){i.textContent="\u4FDD\u5B58\u4E2D...",i.setAttribute("disabled","true");try{let e=await l({url:t.url,title:t.title});u.textContent=e.title??"\u65E0\u6807\u9898",d.textContent=`\u4FDD\u5B58\u4E8E ${new Date(e.createdAt).toLocaleString("zh-CN")}`,g.style.display="block",i.textContent="\u2705 \u5DF2\u4FDD\u5B58",t.id&&chrome.tabs.sendMessage(t.id,{type:"ARTICLE_SAVED",payload:e})}catch(e){i.textContent="\u274C \u4FDD\u5B58\u5931\u8D25",i.removeAttribute("disabled"),console.error("\u4FDD\u5B58\u5931\u8D25:",e)}}});m();})();
