var g="http://127.0.0.1:21897/api";async function n(t,i){let r=`${g}${t}`,e=await fetch(r,{headers:{"Content-Type":"application/json"},...i});if(!e.ok){let o=await e.text().catch(()=>"\u672A\u77E5\u9519\u8BEF");throw new Error(`API \u8BF7\u6C42\u5931\u8D25 [${e.status}]: ${o}`)}return e.json()}async function s(t){return n("/articles",{method:"POST",body:JSON.stringify(t)})}async function h(t){return n(`/highlights?url=${encodeURIComponent(t)}`)}chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"save-to-zreader",title:"\u{1F4BE} \u4FDD\u5B58\u5230 Z-Reader",contexts:["page"]}),chrome.contextMenus.create({id:"highlight-parent",title:"\u{1F58D}\uFE0F Z-Reader \u9AD8\u4EAE",contexts:["selection"]}),chrome.contextMenus.create({id:"highlight-yellow",parentId:"highlight-parent",title:"\u{1F7E1} \u9EC4\u8272\u9AD8\u4EAE",contexts:["selection"]}),chrome.contextMenus.create({id:"highlight-blue",parentId:"highlight-parent",title:"\u{1F535} \u84DD\u8272\u9AD8\u4EAE",contexts:["selection"]}),chrome.contextMenus.create({id:"highlight-green",parentId:"highlight-parent",title:"\u{1F7E2} \u7EFF\u8272\u9AD8\u4EAE",contexts:["selection"]}),chrome.contextMenus.create({id:"highlight-red",parentId:"highlight-parent",title:"\u{1F534} \u7EA2\u8272\u9AD8\u4EAE",contexts:["selection"]}),chrome.contextMenus.create({id:"separator-1",parentId:"highlight-parent",type:"separator",contexts:["selection"]}),chrome.contextMenus.create({id:"highlight-with-note",parentId:"highlight-parent",title:"\u{1F4DD} \u6DFB\u52A0\u7B14\u8BB0\u9AD8\u4EAE",contexts:["selection"]}),chrome.contextMenus.create({id:"search-in-zreader",parentId:"highlight-parent",title:"\u{1F50D} \u5728 Z-Reader \u4E2D\u641C\u7D22",contexts:["selection"]})});chrome.contextMenus.onClicked.addListener(async(t,i)=>{if(!i?.id||!i.url)return;t.menuItemId==="save-to-zreader"&&chrome.tabs.sendMessage(i.id,{type:"SAVE_ARTICLE_WITH_CONTENT"});let r={"highlight-yellow":"yellow","highlight-blue":"blue","highlight-green":"green","highlight-red":"red"};t.menuItemId&&r[t.menuItemId]&&chrome.tabs.sendMessage(i.id,{type:"HIGHLIGHT_SELECTION",payload:{color:r[t.menuItemId]}}),t.menuItemId==="highlight-with-note"&&chrome.tabs.sendMessage(i.id,{type:"HIGHLIGHT_WITH_NOTE"}),t.menuItemId==="search-in-zreader"&&t.selectionText&&chrome.tabs.sendMessage(i.id,{type:"SEARCH_IN_ZREADER",payload:{text:t.selectionText}})});chrome.runtime.onMessage.addListener((t,i,r)=>{if(t.type==="GET_HIGHLIGHTS_BY_URL")return h(t.payload.url).then(e=>r({success:!0,data:e})).catch(e=>r({success:!1,error:e.message})),!0;if(t.type==="SAVE_ARTICLE")return s(t.payload).then(e=>r({success:!0,data:e})).catch(e=>r({success:!1,error:e.message})),!0});
