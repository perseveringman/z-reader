var h="http://127.0.0.1:21897/api";async function s(t,i){let r=`${h}${t}`,e=await fetch(r,{headers:{"Content-Type":"application/json"},...i});if(!e.ok){let c=await e.text().catch(()=>"\u672A\u77E5\u9519\u8BEF");throw new Error(`API \u8BF7\u6C42\u5931\u8D25 [${e.status}]: ${c}`)}return e.json()}async function n(t){return s("/articles",{method:"POST",body:JSON.stringify(t)})}async function o(t){return s(`/highlights?url=${encodeURIComponent(t)}`)}chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"save-to-zreader",title:"\u4FDD\u5B58\u5230 Z-Reader",contexts:["page"]}),chrome.contextMenus.create({id:"highlight-selection",title:"\u9AD8\u4EAE\u9009\u4E2D\u6587\u672C",contexts:["selection"]})});chrome.contextMenus.onClicked.addListener(async(t,i)=>{if(!(!i?.id||!i.url)){if(t.menuItemId==="save-to-zreader")try{let r=await n({url:i.url,title:i.title});chrome.tabs.sendMessage(i.id,{type:"ARTICLE_SAVED",payload:r})}catch(r){console.error("\u4FDD\u5B58\u6587\u7AE0\u5931\u8D25:",r)}t.menuItemId==="highlight-selection"&&t.selectionText&&chrome.tabs.sendMessage(i.id,{type:"HIGHLIGHT_SELECTION",payload:{text:t.selectionText}})}});chrome.runtime.onMessage.addListener((t,i,r)=>{if(t.type==="GET_HIGHLIGHTS_BY_URL")return o(t.payload.url).then(e=>r({success:!0,data:e})).catch(e=>r({success:!1,error:e.message})),!0;if(t.type==="SAVE_ARTICLE")return n(t.payload).then(e=>r({success:!0,data:e})).catch(e=>r({success:!1,error:e.message})),!0});
